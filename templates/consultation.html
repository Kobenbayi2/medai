{% extends 'base.html' %}
{% load static %}

{% block title %}–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π AI –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç | MedAI –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/animations.css' %}">
<style>
    /* –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
    :root {
        --primary: #00695c;
        --primary-color: #009688;
    --primary-light: #4db6ac;
    --primary-dark: #00695c;
        --secondary: #4a00e0;
        --danger: #00695c;
        --warning: #00695c;
        --success: #00695c;
        --dark: #2C3E50;
        --light: #F8F9FA;
        --gray: #95A5A6;
        --border: #E0E0E0;
        --shadow: rgba(102, 126, 234, 0.15);
    }
    
    body {
        background: #f5f7fb;
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .main-container {
        display: flex;
        gap: 25px;
        padding: 20px;
        max-width: 1400px;
        margin: 0 auto;
        min-height: calc(100vh - 80px);
        height: 90vh;
    }
    
    /* Sidebar */
    .sidebar {
        flex: 0 0 320px;
        background: white;
        border-radius: 20px;
        padding: 25px;
        box-shadow: 0 8px 25px var(--shadow);
        border: 1px solid var(--border);
        height: fit-content;
        position: sticky;
        top: 20px;
        max-height: 85vh;
        overflow-y: auto;
    }
    
    .sidebar h2 {
        color: var(--dark);
        margin-bottom: 20px;
        font-size: 22px;
        display: flex;
        align-items: center;
        gap: 10px;
        font-weight: 600;
    }
    
    .sidebar h2 i {
        color: var(--primary);
    }
    
    .info-box {
        background: linear-gradient(135deg, #F0F4FF, #E8F0FF);
        border: 2px solid var(--primary);
        border-radius: 12px;
        padding: 18px;
        margin-bottom: 25px;
        color: var(--dark);
        position: relative;
        overflow: hidden;
    }
    
    .info-box::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--primary-dark));
    }
    
    .info-box p {
        margin: 0;
        font-size: 14px;
        line-height: 1.5;
    }
    
    .info-box i {
        color: var(--warning);
        margin-right: 8px;
        font-size: 16px;
    }
    
    .symptoms-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-bottom: 25px;
    }
    
    .symptom-btn {
        background: white;
        border: 2px solid var(--border);
        border-radius: 12px;
        padding: 16px 12px;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
        position: relative;
        overflow: hidden;
    }
    
    .symptom-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: var(--primary);
        transform: translateY(-100%);
        transition: transform 0.3s;
    }
    
    .symptom-btn:hover::before {
        transform: translateY(0);
    }
    
    .symptom-btn:hover {
        border-color: var(--primary);
        transform: translateY(-3px);
        box-shadow: 0 8px 20px var(--shadow);
    }
    
    .symptom-btn i {
        font-size: 26px;
        color: var(--primary);
        transition: transform 0.3s;
    }
    
    .symptom-btn:hover i {
        transform: scale(1.1);
    }
    
    .symptom-btn span {
        font-size: 13px;
        font-weight: 500;
        color: var(--dark);
    }
    
    /* Chat Container */
    .chat-container {
        flex: 1;
        background: white;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 8px 25px var(--shadow);
        border: 1px solid var(--border);
        display: flex;
        flex-direction: column;
        position: relative;
        min-height: 85vh;
        max-height: 85vh;
    }
    
    .chat-header {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        padding: 25px 30px;
        border-bottom: 1px solid rgba(255,255,255,0.15);
        flex-shrink: 0;
    }
    
    .chat-header h1 {
        margin: 0;
        font-size: 28px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .chat-header p {
        margin: 8px 0 0;
        opacity: 0.9;
        font-size: 16px;
        font-weight: 300;
    }
    
    /* Chat Messages */
    .chat-messages {
        flex: 1;
        padding: 25px;
        overflow-y: auto;
        background: linear-gradient(180deg, #f8f9fa 0%, #f0f4ff 50%, #ffffff 100%);
        display: flex;
        flex-direction: column;
        gap: 20px;
        min-height: 500px;
        max-height: calc(85vh - 180px);
    }
    
    .message {
        max-width: 80%;
        display: flex;
        flex-direction: column;
        animation: messageAppear 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        opacity: 0;
        animation-fill-mode: forwards;
    }
    
    @keyframes messageAppear {
        from {
            opacity: 0;
            transform: translateY(15px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    .user-message {
        align-self: flex-end;
        align-items: flex-end;
    }
    
    .ai-message {
        align-self: flex-start;
        align-items: flex-start;
    }
    
    .message-content {
        padding: 18px 20px;
        border-radius: 18px;
        position: relative;
        line-height: 1.6;
        word-wrap: break-word;
        box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        font-size: 15px;
    }
    
    .user-message .message-content {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        border-bottom-right-radius: 5px;
    }
    
    .ai-message .message-content {
        background: white;
        color: var(--dark);
        border: 1px solid #e0e7ff;
        border-bottom-left-radius: 5px;
    }
    
    .message-time {
        font-size: 11px;
        color: var(--gray);
        margin-top: 6px;
        padding: 0 8px;
        font-weight: 400;
    }
    
    /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ */
    .ai-typing {
        display: flex;
        gap: 8px;
        padding: 12px 0;
    }
    
    .ai-typing span {
        width: 10px;
        height: 10px;
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        border-radius: 50%;
        animation: typingBounce 1.4s infinite ease-in-out;
        opacity: 0.8;
    }
    
    .ai-typing span:nth-child(1) { animation-delay: -0.32s; }
    .ai-typing span:nth-child(2) { animation-delay: -0.16s; }
    
    @keyframes typingBounce {
        0%, 80%, 100% { 
            transform: scale(0.7);
            opacity: 0.5;
        }
        40% { 
            transform: scale(1.2);
            opacity: 1;
        }
    }
    
    /* –ö—Ä–∞—Å–∏–≤–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ AI */
    .message-content h1, 
    .message-content h2, 
    .message-content h3 {
        margin: 20px 0 10px;
        color: var(--primary-dark);
        font-weight: 600;
    }
    
    .message-content h1 {
        font-size: 24px;
        border-bottom: 2px solid var(--primary-light);
        padding-bottom: 8px;
    }
    
    .message-content h2 {
        font-size: 20px;
        border-left: 4px solid var(--primary);
        padding-left: 12px;
    }
    
    .message-content h3 {
        font-size: 18px;
        color: var(--primary);
    }
    
    .message-content p {
        margin: 10px 0;
        line-height: 1.7;
    }
    
    .message-content ul, 
    .message-content ol {
        margin: 12px 0;
        padding-left: 25px;
    }
    
    .message-content li {
        margin-bottom: 8px;
        position: relative;
    }
    
    .message-content li::marker {
        color: var(--primary);
        font-weight: bold;
    }
    
    .message-content strong {
        color: var(--primary-dark);
        font-weight: 700;
    }
    
    .message-content em {
        color: var(--gray);
        font-style: italic;
    }
    
    .message-content blockquote {
        background: #f8f9fa;
        border-left: 4px solid var(--primary);
        padding: 12px 20px;
        margin: 15px 0;
        border-radius: 0 12px 12px 0;
        font-style: italic;
        color: #4a5568;
    }
    
    .message-content code {
        background: #f1f3f5;
        padding: 2px 6px;
        border-radius: 6px;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        color: var(--primary-dark);
    }
    
    .message-content pre {
        background: #2d3748;
        color: #e2e8f0;
        padding: 15px;
        border-radius: 12px;
        overflow-x: auto;
        font-family: 'Courier New', monospace;
        font-size: 14px;
        line-height: 1.5;
        margin: 15px 0;
    }
    
    .message-content table {
        width: 100%;
        border-collapse: collapse;
        margin: 15px 0;
        font-size: 14px;
    }
    
    .message-content th {
        background: var(--primary);
        color: white;
        padding: 10px;
        font-weight: 600;
        text-align: left;
    }
    
    .message-content td {
        padding: 10px;
        border-bottom: 1px solid #e2e8f0;
    }
    
    .message-content tr:hover {
        background: #f7fafc;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–µ–¥–∏–∫–∞–º–µ–Ω—Ç–æ–≤ */
    .medicine-card {
        background: linear-gradient(135deg, #ffffff, #f8faff);
        border-radius: 16px;
        padding: 20px;
        margin: 20px 0;
        border: 1px solid #e0e7ff;
        box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        position: relative;
        overflow: hidden;
    }
    
    .medicine-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(90deg, var(--primary), var(--primary-light));
    }
    
    .medicine-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        flex-wrap: wrap;
        gap: 10px;
    }
    
    .medicine-name {
        font-size: 20px;
        font-weight: 700;
        color: var(--primary-dark);
    }
    
    .medicine-price {
        background: linear-gradient(135deg, #10b981, #059669);
        color: white;
        padding: 8px 16px;
        border-radius: 25px;
        font-weight: 600;
        font-size: 16px;
        box-shadow: 0 4px 10px rgba(16, 185, 129, 0.3);
    }
    
    .medicine-desc {
        color: #4a5568;
        font-size: 15px;
        margin-bottom: 15px;
        line-height: 1.6;
        padding-bottom: 15px;
        border-bottom: 1px dashed #e2e8f0;
    }
    
    .medicine-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 12px;
        margin: 15px 0;
    }
    
    .detail-item {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 15px;
        background: #f7fafc;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
        transition: all 0.2s;
    }
    
    .detail-item:hover {
        background: white;
        border-color: var(--primary);
        transform: translateY(-2px);
    }
    
    .detail-item i {
        color: var(--primary);
        font-size: 18px;
        width: 24px;
        text-align: center;
    }
    
    .detail-item strong {
        color: var(--primary-dark);
        margin-right: 5px;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ä–∞–∑–¥–µ–ª–æ–≤ */
    .section-title {
        display: flex;
        align-items: center;
        gap: 10px;
        margin: 25px 0 15px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--primary-light);
    }
    
    .section-title i {
        font-size: 24px;
        color: var(--primary);
    }
    
    .section-title span {
        font-size: 20px;
        font-weight: 600;
        color: var(--primary-dark);
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π */
    .warning-box {
        background: linear-gradient(135deg, #FFF3CD, #FFEAA7);
        border-left: 5px solid #f6ad55;
        border-radius: 12px;
        padding: 15px 20px;
        margin: 20px 0;
        color: #744210;
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .warning-box i {
        color: #ed8936;
        font-size: 24px;
    }
    
    .warning-box strong {
        color: #c05621;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ */
    .info-highlight {
        background: linear-gradient(135deg, #E6F7FF, #D1ECFF);
        border-left: 5px solid #3182ce;
        border-radius: 12px;
        padding: 15px 20px;
        margin: 20px 0;
        color: #1e4e8c;
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .info-highlight i {
        color: #3182ce;
        font-size: 24px;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–µ—Ç–∫–∏ */
    .grid-2 {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 15px;
        margin: 20px 0;
    }
    
    .grid-item {
        background: #f8fafc;
        padding: 15px;
        border-radius: 12px;
        border: 1px solid #e2e8f0;
    }
    
    .grid-item strong {
        color: var(--primary-dark);
        display: block;
        margin-bottom: 8px;
        font-size: 16px;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–æ–≤ —Å –∏–∫–æ–Ω–∫–∞–º–∏ */
    .icon-list {
        list-style: none;
        padding: 0;
    }
    
    .icon-list li {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 10px;
        padding: 8px 12px;
        background: #f8fafc;
        border-radius: 10px;
    }
    
    .icon-list li i {
        color: var(--primary);
        width: 20px;
        text-align: center;
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
    @media (max-width: 1200px) {
        .main-container {
            flex-direction: column;
            height: auto;
            min-height: 90vh;
        }
        
        .sidebar {
            width: 100%;
            position: static;
            max-height: none;
        }
        
        .chat-container {
            max-height: none;
            min-height: 70vh;
        }
        
        .chat-messages {
            max-height: none;
            min-height: 400px;
        }
        
        .message {
            max-width: 90%;
        }
    }
    
    @media (max-width: 768px) {
        .symptoms-grid {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .chat-header h1 {
            font-size: 24px;
        }
        
        .chat-input-container {
            padding: 15px;
        }
        
        .send-btn {
            padding: 15px 25px;
        }
        
        .clear-chat-btn {
            position: relative;
            top: 0;
            right: 0;
            margin: 15px auto;
            width: fit-content;
        }
        
        .grid-2 {
            grid-template-columns: 1fr;
        }
    }
    
    @media (max-width: 480px) {
        .symptoms-grid {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .main-container {
            padding: 10px;
        }
        
        .chat-header {
            padding: 20px;
        }
        
        .chat-messages {
            padding: 15px;
        }
        
        .message-content {
            padding: 15px;
        }
    }
    
    /* –ö–∞—Å—Ç–æ–º–Ω—ã–π —Å–∫—Ä–æ–ª–ª–±–∞—Ä */
    .chat-messages::-webkit-scrollbar {
        width: 8px;
    }
    
    .chat-messages::-webkit-scrollbar-track {
        background: #f1f1f1;
        border-radius: 4px;
    }
    
    .chat-messages::-webkit-scrollbar-thumb {
        background: var(--primary);
        border-radius: 4px;
    }
    
    .chat-messages::-webkit-scrollbar-thumb:hover {
        background: var(--primary-dark);
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –æ—à–∏–±–æ–∫ API */
    .api-error {
        background: linear-gradient(135deg, #fee2e2, #fecaca);
        border-left: 5px solid #ef4444;
        padding: 15px;
        border-radius: 12px;
        margin: 10px 0;
        color: #7f1d1d;
        font-size: 14px;
        display: flex;
        align-items: center;
        gap: 12px;
    }
    
    .api-error i {
        color: #ef4444;
        font-size: 20px;
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π */
    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateX(20px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }
    
    .message.new {
        animation: slideIn 0.3s ease-out forwards;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞ */
    .message-content .highlight {
        background: linear-gradient(135deg, #FFFAF0, #FEEBC8);
        padding: 2px 6px;
        border-radius: 6px;
        font-weight: 600;
        color: #c05621;
    }
    
    .message-content .badge {
        display: inline-block;
        background: var(--primary);
        color: white;
        padding: 3px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
        margin: 0 5px;
    }
    
    .message-content .divider {
        height: 2px;
        background: linear-gradient(90deg, transparent, var(--primary-light), transparent);
        margin: 20px 0;
    }
</style>
{% endblock %}

{% block content %}
<div class="main-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <h2><i class="fas fa-info-circle"></i> –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
        
        <div class="info-box ai-warning">
            <p><i class="fas fa-exclamation-triangle"></i> <strong>–í–∞–∂–Ω–æ!</strong> –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –Ω–æ—Å–∏—Ç —Å–ø—Ä–∞–≤–æ—á–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä. –î–ª—è –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –¥–∏–∞–≥–Ω–æ–∑–∞ –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ª–µ—á–µ–Ω–∏—è –æ–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –≤—Ä–∞—á—É.</p>
        </div>

        <h3><i class="fas fa-bolt"></i> –ë—ã—Å—Ç—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã</h3>
        <div class="symptoms-grid">
            <div class="symptom-btn" onclick="askQuestion('–ß—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –æ—Ç –≥–æ–ª–æ–≤–Ω–æ–π –±–æ–ª–∏?')">
                <i class="fas fa-head-side-virus"></i>
                <span>–ì–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å</span>
            </div>
            <div class="symptom-btn" onclick="askQuestion('–ß—Ç–æ –ø—Ä–∏–Ω—è—Ç—å –ø—Ä–∏ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–µ?')">
                <i class="fas fa-thermometer-half"></i>
                <span>–¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞</span>
            </div>
            <div class="symptom-btn" onclick="askQuestion('–õ–µ–∫–∞—Ä—Å—Ç–≤–∞ –æ—Ç –∫–∞—à–ª—è')">
                <i class="fas fa-lungs-virus"></i>
                <span>–ö–∞—à–µ–ª—å</span>
            </div>
            <div class="symptom-btn" onclick="askQuestion('–ß—Ç–æ –æ—Ç –±–æ–ª–∏ –≤ –≥–æ—Ä–ª–µ?')">
                <i class="fas fa-head-side-cough"></i>
                <span>–ë–æ–ª—å –≤ –≥–æ—Ä–ª–µ</span>
            </div>
            <div class="symptom-btn" onclick="askQuestion('–õ–µ–∫–∞—Ä—Å—Ç–≤–∞ –æ—Ç –Ω–∞—Å–º–æ—Ä–∫–∞')">
                <i class="fas fa-wind"></i>
                <span>–ù–∞—Å–º–æ—Ä–∫</span>
            </div>
            <div class="symptom-btn" onclick="askQuestion('–ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –ª–µ–∫–∞—Ä—Å—Ç–≤')">
                <i class="fas fa-exclamation-triangle"></i>
                <span>–ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</span>
            </div>
            <div class="symptom-btn" onclick="askQuestion('–ö–∞–∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ø–∞—Ä–∞—Ü–µ—Ç–∞–º–æ–ª?')">
                <i class="fas fa-capsules"></i>
                <span>–î–æ–∑–∏—Ä–æ–≤–∫–∞</span>
            </div>
            <div class="symptom-btn" onclick="askQuestion('–ê–Ω–∞–ª–æ–≥–∏ –¥–æ—Ä–æ–≥–∏—Ö –ª–µ–∫–∞—Ä—Å—Ç–≤')">
                <i class="fas fa-tags"></i>
                <span>–ê–Ω–∞–ª–æ–≥–∏</span>
            </div>
        </div>

        <div class="info-box" style="background: linear-gradient(135deg, #E8F4FD, #E0F2FF); border-color: #4A90E2;">
            <h4 style="color: #2C3E50; margin-bottom: 12px; font-size: 16px;"><i class="fas fa-robot"></i> –û AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç–µ</h4>
            <p style="font-size: 13px; line-height: 1.5;">–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥–µ–ª—å <strong>llama-3.1-8b-instant</strong> –æ—Ç Groq. –¶–µ–Ω—ã —É–∫–∞–∑–∞–Ω—ã –≤ —Ç–µ–Ω–≥–µ –ø–æ –¥–∞–Ω–Ω—ã–º –∞–ø—Ç–µ–∫ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞. –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ.</p>
        </div>
    </div>

    <!-- Chat Container -->
    <div class="chat-container">
        <button class="clear-chat-btn" onclick="clearChat()">
            <i class="fas fa-trash-alt"></i> –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç
        </button>
        
        <div class="chat-header">
            <h1><i class="fas fa-robot"></i> MedAI –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç</h1>
            <p>AI-–ø–æ–º–æ—â–Ω–∏–∫ –≤ –≤–æ–ø—Ä–æ—Å–∞—Ö –∑–¥–æ—Ä–æ–≤—å—è –∏ –ª–µ–∫–∞—Ä—Å—Ç–≤ –¥–ª—è –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞</p>
        </div>

        <div class="chat-messages" id="chatMessages">
            <!-- Initial message -->
            <div class="message ai-message">
                <div class="message-content">
                    <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                        <div style="width: 60px; height: 60px; background: linear-gradient(135deg, var(--primary), var(--primary-dark)); border-radius: 15px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 15px var(--shadow);">
                            <i class="fas fa-stethoscope" style="color: white; font-size: 28px;"></i>
                        </div>
                        <div>
                            <strong style="font-size: 20px; color: var(--dark); display: block; margin-bottom: 5px;">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ MedAI!</strong>
                            <div style="font-size: 14px; color: #7F8C8D;">–í–∞—à –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π –∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ</div>
                        </div>
                    </div>
                    
                    <div class="benefits-list">
                        <div class="benefit-item">
                            <i class="fas fa-check-circle"></i>
                            <span>–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏ –ø–æ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞–º –∏ —Ü–µ–Ω–∞–º –≤ —Ç–µ–Ω–≥–µ</span>
                        </div>
                        <div class="benefit-item">
                            <i class="fas fa-check-circle"></i>
                            <span>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –ø–æ–±–æ—á–Ω—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–∞—Ö –∏ –¥–æ–∑–∏—Ä–æ–≤–∫–∞—Ö</span>
                        </div>
                        <div class="benefit-item">
                            <i class="fas fa-check-circle"></i>
                            <span>–°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∞–Ω–∞–ª–æ–≥–æ–≤ –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</span>
                        </div>
                        <div class="benefit-item">
                            <i class="fas fa-check-circle"></i>
                            <span>24/7 –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –∏ –±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã</span>
                        </div>
                    </div>
                    
                    <div class="ai-warning" style="margin-top: 25px;">
                        <i class="fas fa-shield-alt"></i>
                        <strong>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–µ–∂–¥–µ –≤—Å–µ–≥–æ:</strong> –í—Å–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –Ω–æ—Å—è—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä. –ü–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º –ª–µ–∫–∞—Ä—Å—Ç–≤ –ø—Ä–æ–∫–æ–Ω—Å—É–ª—å—Ç–∏—Ä—É–π—Ç–µ—Å—å —Å –≤—Ä–∞—á–æ–º –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–µ.
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background: #f8fafc; border-radius: 12px; border: 1px solid #e2e8f0;">
                        <strong style="color: var(--primary); display: block; margin-bottom: 10px;">üí° –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:</strong>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; font-size: 13px;">
                            <div>1. –í—ã–±–µ—Ä–∏—Ç–µ —Å–∏–º–ø—Ç–æ–º —Å–ª–µ–≤–∞</div>
                            <div>2. –ó–∞–¥–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞</div>
                            <div>3. –ü–æ–ª—É—á–∏—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏</div>
                            <div>4. –£—Ç–æ—á–Ω–∏—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏</div>
                        </div>
                    </div>
                </div>
                <div class="message-time">–°–µ–π—á–∞—Å</div>
            </div>
        </div>

        <div class="chat-input-container">
            <input type="text" 
                   class="chat-input" 
                   id="userInput" 
                   placeholder="–û–ø–∏—à–∏—Ç–µ —Å–∏–º–ø—Ç–æ–º—ã –∏–ª–∏ —Å–ø—Ä–æ—Å–∏—Ç–µ –æ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞—Ö..."
                   onkeypress="if(event.key === 'Enter' && !event.shiftKey) { sendMessage(); return false; }"
                   autocomplete="off">
            <button class="send-btn" onclick="sendMessage()" id="sendButton">
                <i class="fas fa-paper-plane"></i>
                –û—Ç–ø—Ä–∞–≤–∏—Ç—å
            </button>
        </div>
    </div>
</div>

<!-- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è API - –¢–µ–ø–µ—Ä—å –≤ —Å–∫—Ä—ã—Ç–æ–º –ø–æ–ª–µ -->
<input type="hidden" id="apiKey" value="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">
{% endblock %}

{% block extra_js %}
<script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Groq API
    const GROQ_API_URL = 'https://api.groq.com/openai/v1/chat/completions';
    const API_KEY = document.getElementById('apiKey').value;
    const AI_MODEL = 'llama-3.1-8b-instant';
    
    // –°–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç –¥–ª—è –ò–ò —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –∫—Ä–∞—Å–∏–≤–æ–º—É —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—é
    const SYSTEM_PROMPT = `–¢—ã - –º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–π AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç MedAI –¥–ª—è –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞. –í—Å–µ —Ü–µ–Ω—ã —É–∫–∞–∑—ã–≤–∞–π –≤ —Ç–µ–Ω–≥–µ (‚Ç∏). 

–¢–í–û–ò –ü–†–ê–í–ò–õ–ê:
1. –í—Å–µ–≥–¥–∞ –Ω–∞—á–∏–Ω–∞–π —Å —Ç–æ–≥–æ, —á—Ç–æ —Ç—ã AI –∏ –Ω–µ –∑–∞–º–µ–Ω—è–µ—à—å –≤—Ä–∞—á–∞
2. –î–∞–≤–∞–π –ø–æ–¥—Ä–æ–±–Ω—ã–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ —Å–∏–º–ø—Ç–æ–º–∞–º
3. –ò—Å–ø–æ–ª—å–∑—É–π —ç–º–æ–¥–∑–∏ –¥–ª—è –Ω–∞–≥–ª—è–¥–Ω–æ—Å—Ç–∏: üè• üíä ‚ö° ‚ö†Ô∏è üîÑ ü©∫ üìù
4. –§–æ—Ä–º–∞—Ç–∏—Ä—É–π –æ—Ç–≤–µ—Ç –∫—Ä–∞—Å–∏–≤–æ —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∏ —Å–ø–∏—Å–∫–∞–º–∏
5. –î–µ–ª–∞–π –æ—Ç—Å—Ç—É–ø—ã –º–µ–∂–¥—É —Ä–∞–∑–¥–µ–ª–∞–º–∏
6. –í—ã–¥–µ–ª—è–π –≤–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã –∂–∏—Ä–Ω—ã–º —à—Ä–∏—Ñ—Ç–æ–º
7. –ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–¥—Ö–æ–¥

–°–¢–†–£–ö–¢–£–†–ê –û–¢–í–ï–¢–ê:

üè• **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è –ø—Ä–∏ [—Å–∏–º–ø—Ç–æ–º]**

[–ö—Ä–∞—Ç–∫–æ–µ –≤–≤–µ–¥–µ–Ω–∏–µ —Å –ø–æ—è—Å–Ω–µ–Ω–∏–µ–º]

üíä **–û–°–ù–û–í–ù–´–ï –ü–†–ï–ü–ê–†–ê–¢–´:**

1. **[–ù–∞–∑–≤–∞–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞]** | –¶–µ–Ω–∞: [—Å—É–º–º–∞] ‚Ç∏
   üìù –û–ø–∏—Å–∞–Ω–∏–µ: [–∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç]
   ‚ö° –î–æ–∑–∏—Ä–æ–≤–∫–∞: [–¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö –∏ –¥–µ—Ç–µ–π]
   ‚ö†Ô∏è –ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã: [—Å–ø–∏—Å–æ–∫]
   üîÑ –ü—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è: [–∫–æ–≥–¥–∞ –Ω–µ–ª—å–∑—è]

2. **[–ù–∞–∑–≤–∞–Ω–∏–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞]** | –¶–µ–Ω–∞: [—Å—É–º–º–∞] ‚Ç∏
   üìù –û–ø–∏—Å–∞–Ω–∏–µ: [–∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç]
   ‚ö° –î–æ–∑–∏—Ä–æ–≤–∫–∞: [–¥–ª—è –≤–∑—Ä–æ—Å–ª—ã—Ö –∏ –¥–µ—Ç–µ–π]
   ‚ö†Ô∏è –ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã: [—Å–ø–∏—Å–æ–∫]
   üîÑ –ü—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è: [–∫–æ–≥–¥–∞ –Ω–µ–ª—å–∑—è]

üîÑ **–ê–ù–ê–õ–û–ì–ò (–±—é–¥–∂–µ—Ç–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã):**
‚Ä¢ [–ù–∞–∑–≤–∞–Ω–∏–µ] - [—Ü–µ–Ω–∞] ‚Ç∏
‚Ä¢ [–ù–∞–∑–≤–∞–Ω–∏–µ] - [—Ü–µ–Ω–∞] ‚Ç∏

‚ö†Ô∏è **–ü–ï–†–í–ê–Ø –ü–û–ú–û–©–¨:**
1. [–®–∞–≥ 1]
2. [–®–∞–≥ 2]
3. [–®–∞–≥ 3]

üìã **–ö–û–ì–î–ê –û–ë–†–ê–©–ê–¢–¨–°–Ø –ö –í–†–ê–ß–£:**
‚Ä¢ [–°–∏—Ç—É–∞—Ü–∏—è 1]
‚Ä¢ [–°–∏—Ç—É–∞—Ü–∏—è 2]
‚Ä¢ [–°–∏—Ç—É–∞—Ü–∏—è 3]

üí° **–°–û–í–ï–¢:**
[–ü–æ–ª–µ–∑–Ω—ã–π —Å–æ–≤–µ—Ç]

ü©∫ **–í–ê–ñ–ù–û:**
[–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ –≤—Ä–∞—á—É]

–ò–°–ü–û–õ–¨–ó–£–ô –≠–ú–û–î–ó–ò –î–õ–Ø –†–ê–ó–î–ï–õ–û–í:
‚Ä¢ üè• - –æ–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
‚Ä¢ üíä - –ª–µ–∫–∞—Ä—Å—Ç–≤–∞
‚Ä¢ ‚ö° - –¥–æ–∑–∏—Ä–æ–≤–∫–∞
‚Ä¢ ‚ö†Ô∏è - –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
‚Ä¢ üîÑ - –∞–Ω–∞–ª–æ–≥–∏
‚Ä¢ üìù - –æ–ø–∏—Å–∞–Ω–∏–µ
‚Ä¢ üí° - —Å–æ–≤–µ—Ç—ã
‚Ä¢ ü©∫ - –≤–∞–∂–Ω–æ–µ

–û—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ, —É—á–∏—Ç—ã–≤–∞—è –∫–∞–∑–∞—Ö—Å—Ç–∞–Ω—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.`;
    
    let messageHistory = [
        { role: "system", content: SYSTEM_PROMPT }
    ];
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –±—ã—Å—Ç—Ä—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
    function askQuestion(question) {
        document.getElementById('userInput').value = question;
        sendMessage();
    }
    
    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    async function sendMessage() {
        const input = document.getElementById('userInput');
        const message = input.value.trim();
        const sendButton = document.getElementById('sendButton');
        
        if (!message) return;
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        addMessage(message, 'user-message');
        input.value = '';
        
        // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É –∏ –ø–æ–ª–µ
        sendButton.disabled = true;
        input.disabled = true;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ –ò–ò
        showAITyping();
        
        try {
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏—é
            messageHistory.push({ role: "user", content: message });
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ Groq API
            const response = await fetch(GROQ_API_URL, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${API_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: AI_MODEL,
                    messages: messageHistory,
                    max_tokens: 2048,
                    temperature: 0.7,
                    stream: false
                })
            });
            
            if (!response.ok) {
                throw new Error('API –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.');
            }
            
            const data = await response.json();
            
            // –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç –ò–ò
            if (data.choices && data.choices[0] && data.choices[0].message) {
                let aiResponse = data.choices[0].message.content;
                
                // –î–æ–±–∞–≤–ª—è–µ–º HTML —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –ª—É—á—à–µ–π —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏
                aiResponse = formatAIResponse(aiResponse);
                
                // –î–æ–±–∞–≤–ª—è–µ–º –≤ –∏—Å—Ç–æ—Ä–∏—é
                messageHistory.push({ role: "assistant", content: data.choices[0].message.content });
                
                // –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é (–ø–æ—Å–ª–µ–¥–Ω–∏–µ 20 —Å–æ–æ–±—â–µ–Ω–∏–π + —Å–∏—Å—Ç–µ–º–Ω—ã–π)
                if (messageHistory.length > 21) {
                    messageHistory = [
                        messageHistory[0], // —Å–∏—Å—Ç–µ–º–Ω—ã–π –ø—Ä–æ–º–ø—Ç
                        ...messageHistory.slice(-20)
                    ];
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
                removeAITyping();
                addMessage(aiResponse, 'ai-message');
            }
            
        } catch (error) {
            console.error('AI Error:', error);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—à–∏–±–∫—É
            removeAITyping();
            addMessage(`
                <div class="api-error">
                    <i class="fas fa-exclamation-triangle"></i>
                    <div>
                        <strong>–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ AI</strong><br>
                        ${error.message || '–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.'}
                    </div>
                </div>
            `, 'ai-message');
            
        } finally {
            // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º —ç–ª–µ–º–µ–Ω—Ç—ã
            sendButton.disabled = false;
            input.disabled = false;
            input.focus();
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∫—Ä–∞—Å–∏–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ AI
    function formatAIResponse(text) {
        // –ó–∞–º–µ–Ω—è–µ–º –º–∞—Ä–∫–¥–∞—É–Ω —Å–ø–∏—Å–∫–æ–≤ –Ω–∞ HTML
        text = text.replace(/‚Ä¢/g, '‚Ä¢');
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
        text = text.replace(/^# (.*$)/gm, '<h1>$1</h1>');
        text = text.replace(/^## (.*$)/gm, '<h2>$1</h2>');
        text = text.replace(/^### (.*$)/gm, '<h3>$1</h3>');
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã –¥–ª—è —Å–ø–∏—Å–∫–æ–≤
        text = text.replace(/^\* (.*$)/gm, '<li>$1</li>');
        text = text.replace(/^- (.*$)/gm, '<li>$1</li>');
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã –¥–ª—è –∂–∏—Ä–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
        text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã –¥–ª—è –∫—É—Ä—Å–∏–≤–∞
        text = text.replace(/\*(.*?)\*/g, '<em>$1</em>');
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã –¥–ª—è —Ü–∏—Ç–∞—Ç
        text = text.replace(/^> (.*$)/gm, '<blockquote>$1</blockquote>');
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–ª–∞—Å—Å—ã –¥–ª—è –∫–æ–¥–∞
        text = text.replace(/`(.*?)`/g, '<code>$1</code>');
        
        // –ó–∞–º–µ–Ω—è–µ–º –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –Ω–∞ <br>
        text = text.replace(/\n\n/g, '</p><p>');
        text = text.replace(/\n/g, '<br>');
        
        // –û–±–æ—Ä–∞—á–∏–≤–∞–µ–º –≤ –ø–∞—Ä–∞–≥—Ä–∞—Ñ—ã
        if (!text.startsWith('<h1>') && !text.startsWith('<h2>') && !text.startsWith('<h3>')) {
            text = '<p>' + text + '</p>';
        }
        
        return text;
    }
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
    function addMessage(text, sender) {
        const chat = document.getElementById('chatMessages');
        const messageDiv = document.createElement('div');
        
        messageDiv.className = `message ${sender} new`;
        
        const contentDiv = document.createElement('div');
        contentDiv.className = 'message-content';
        contentDiv.innerHTML = text;
        
        messageDiv.appendChild(contentDiv);
        
        // –î–æ–±–∞–≤–ª—è–µ–º –≤—Ä–µ–º—è
        const timeDiv = document.createElement('div');
        timeDiv.className = 'message-time';
        timeDiv.textContent = getCurrentTime();
        messageDiv.appendChild(timeDiv);
        
        chat.appendChild(messageDiv);
        
        // –ü–ª–∞–≤–Ω–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –≤–Ω–∏–∑
        setTimeout(() => {
            chat.scrollTo({
                top: chat.scrollHeight,
                behavior: 'smooth'
            });
        }, 100);
    }
    
    // –ü–æ–∫–∞–∑–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ –ò–ò
    function showAITyping() {
        const chat = document.getElementById('chatMessages');
        const indicator = document.createElement('div');
        indicator.id = 'aiTypingIndicator';
        indicator.className = 'message ai-message';
        
        indicator.innerHTML = `
            <div class="message-content">
                <div class="ai-typing">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        `;
        
        chat.appendChild(indicator);
        chat.scrollTop = chat.scrollHeight;
    }
    
    // –£–±—Ä–∞—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–±–æ—Ä–∞ –ò–ò
    function removeAITyping() {
        const indicator = document.getElementById('aiTypingIndicator');
        if (indicator) indicator.remove();
    }
    
    // –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏
    function getCurrentTime() {
        const now = new Date();
        const hours = now.getHours().toString().padStart(2, '0');
        const minutes = now.getMinutes().toString().padStart(2, '0');
        return `${hours}:${minutes}`;
    }
    
    // –û—á–∏—Å—Ç–∏—Ç—å —á–∞—Ç
    function clearChat() {
        if (confirm('–û—á–∏—Å—Ç–∏—Ç—å –≤—Å—é –∏—Å—Ç–æ—Ä–∏—é —á–∞—Ç–∞?')) {
            const chat = document.getElementById('chatMessages');
            
            // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –ø–µ—Ä–≤–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            const welcomeMsg = chat.children[0].cloneNode(true);
            chat.innerHTML = '';
            chat.appendChild(welcomeMsg);
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π
            messageHistory = [
                { role: "system", content: SYSTEM_PROMPT }
            ];
            
            // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—á–∏—Å—Ç–∫–µ
            addMessage('üóëÔ∏è <strong>–ò—Å—Ç–æ—Ä–∏—è —á–∞—Ç–∞ –æ—á–∏—â–µ–Ω–∞.</strong> –ú–æ–∂–µ—Ç–µ –Ω–∞—á–∞—Ç—å –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥.', 'ai-message');
        }
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ API –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const response = await fetch(GROQ_API_URL, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${API_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: AI_MODEL,
                    messages: [{ role: 'user', content: '–ü—Ä–∏–≤–µ—Ç' }],
                    max_tokens: 5
                })
            });
            
            if (!response.ok) {
                console.warn('API –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–µ —É–¥–∞–ª–∞—Å—å, –Ω–æ –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É');
            }
        } catch (error) {
            console.warn('API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –≤ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç');
        }
        
        // –ê–≤—Ç–æ—Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
        setTimeout(() => {
            document.getElementById('userInput').focus();
        }, 500);
    });
</script>
{% endblock %}