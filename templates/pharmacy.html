{% extends 'base.html' %}
{% load static %}

{% block title %}–ê–ø—Ç–µ–∫–∞ | MedAI{% endblock %}

{% block extra_css %}
<style>
    /* –û—Å–Ω–æ–≤–Ω—ã–µ —Ü–≤–µ—Ç–∞ */
    :root {
        --primary-color: #2d8f6d;
        --primary-hover: #247158;
        --border-radius: 10px;
        --shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
    }
    
    /* –ö–∞—Ä—Ç–æ—á–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ —Å —É–≤–µ–ª–∏—á–µ–Ω–Ω—ã–º —Ñ–æ—Ç–æ */
    .product-card {
        display: flex;
        flex-direction: column;
        height: 100%;
        min-height: 380px;
        background: white;
        border-radius: var(--border-radius);
        overflow: hidden;
        box-shadow: var(--shadow);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    
    .product-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
    }
    
    .product-info {
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 15px;
    }
    
    .product-title {
        font-size: 1.1rem;
        margin-bottom: 8px;
        color: #2d3748;
        line-height: 1.3;
        height: 2.6em;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
    }
    
    .product-description {
        flex: 1;
        color: #718096;
        font-size: 0.9rem;
        line-height: 1.4;
        margin-bottom: 12px;
        overflow: hidden;
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        min-height: 2.8em;
    }
    
    .product-price {
        font-size: 1.3rem;
        font-weight: bold;
        color: var(--primary-color);
        margin: 8px 0;
    }
    
    .product-actions {
        margin-top: auto;
        display: flex;
        gap: 8px;
    }
    
    /* –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ */
    .product-image {
        width: 100%;
        height: 260px; /* –£–≤–µ–ª–∏—á–∏–ª –≤—ã—Å–æ—Ç—É –¥–ª—è –ª—É—á—à–µ–π –≤–∏–¥–∏–º–æ—Å—Ç–∏ */
        overflow: hidden;
        border-radius: var(--border-radius) var(--border-radius) 0 0;
        background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        position: relative;
        padding: 20px; /* –î–æ–±–∞–≤–∏–ª –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è —Ñ–æ—Ç–æ */
    }
    
    .product-image img {
        width: 100%;
        height: 100%;
        object-fit: contain; /* –°–æ—Ö—Ä–∞–Ω—è–µ–º –ø—Ä–æ–ø–æ—Ä—Ü–∏–∏ */
        object-position: center;
        transition: transform 0.4s ease;
        max-width: 100%;
        max-height: 100%;
        padding: 0; /* –£–±—Ä–∞–ª –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –æ—Ç—Å—Ç—É–ø—ã */
    }
    
    .product-card:hover .product-image img {
        transform: scale(1.08);
    }
    
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ç–æ–≤–∞—Ä–∞ */
    .product-modal .modal-content {
        max-width: 1000px;
        width: 95%;
        max-height: 80vh;
        overflow-y: auto;
        border-radius: var(--border-radius);
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
        background: white;
        border: 1px solid #e2e8f0;
    }
    
    .product-modal .modal-body {
        padding: 25px;
        max-height: calc(80vh - 110px);
        overflow-y: auto;
    }
    
    .product-modal-content {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        align-items: start;
    }
    
    .product-modal-image {
        width: 100%;
        height: 400px; /* –£–≤–µ–ª–∏—á–∏–ª –≤—ã—Å–æ—Ç—É –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ */
        overflow: hidden;
        border-radius: var(--border-radius);
        background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: var(--shadow);
        border: 1px solid #e2e8f0;
        padding: 30px; /* –î–æ–±–∞–≤–∏–ª –æ—Ç—Å—Ç—É–ø—ã */
    }
    
    .product-modal-image img {
        width: 100%;
        height: 100%;
        object-fit: contain;
        object-position: center;
        max-width: 100%;
        max-height: 100%;
    }
    
    .product-modal-info {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }
    
    .product-modal-info h3 {
        font-size: 1.5rem;
        margin: 0;
        color: #2d3748;
        line-height: 1.3;
    }
    
    .product-modal-price {
        font-size: 1.8rem;
        font-weight: bold;
        color: var(--primary-color);
        margin: 10px 0;
    }
    
    .product-modal-description {
        font-size: 1rem;
        line-height: 1.6;
        color: #4a5568;
        padding: 15px;
        background: #f7fafc;
        border-radius: 8px;
        border-left: 3px solid var(--primary-color);
        max-height: 300px;
        overflow-y: auto;
    }
    
    .product-modal-actions {
        display: flex;
        gap: 12px;
        margin-top: 20px;
    }
    
    .product-modal-actions .btn-outline {
        flex: 1;
        padding: 12px;
        font-size: 1rem;
        border: 2px solid #e2e8f0;
        color: #4a5568;
    }
    
    .product-modal-actions .btn-primary {
        flex: 2;
        padding: 12px;
        font-size: 1rem;
        background: var(--primary-color);
        border: none;
    }
    
    .product-modal-actions .btn-primary:hover {
        background: var(--primary-hover);
    }
    
    /* –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è –∫–æ—Ä–∑–∏–Ω–∞ */
    .cart-modal-content {
        max-width: 600px;
        width: 95%;
        max-height: 75vh;
        border-radius: var(--border-radius);
        background: white;
        border: 1px solid #e2e8f0;
    }
    
    .cart-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px;
        background: #f7fafc;
        border-radius: 8px;
        margin-bottom: 10px;
        border-left: 3px solid var(--primary-color);
        transition: all 0.2s ease;
    }
    
    .cart-item:hover {
        background: #edf2f7;
    }
    
    .cart-item-info h4 {
        margin: 0 0 5px 0;
        color: #2d3748;
        font-size: 1rem;
        max-width: 300px;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    
    .cart-item-info p {
        margin: 0;
        color: #4a5568;
        font-size: 0.9rem;
    }
    
    .cart-item-actions {
        display: flex;
        align-items: center;
        gap: 15px;
    }
    
    .cart-item-remove {
        background: #fc8181;
        color: white;
        border: none;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.2s ease;
        font-size: 0.8rem;
        flex-shrink: 0;
    }
    
    .cart-item-remove:hover {
        background: #f56565;
        transform: scale(1.1);
    }
    
    .cart-item-total {
        font-size: 1.1rem;
        font-weight: bold;
        color: var(--primary-color);
        min-width: 80px;
        text-align: right;
        flex-shrink: 0;
    }
    
    .cart-summary {
        background: #f7fafc;
        padding: 20px;
        border-radius: var(--border-radius);
        margin-top: 15px;
        border: 1px solid #e2e8f0;
    }
    
    .cart-total-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        font-size: 1.1rem;
        color: #4a5568;
    }
    
    .cart-total-row.total {
        font-size: 1.3rem;
        font-weight: bold;
        color: #2d3748;
        margin-top: 15px;
        padding-top: 15px;
        border-top: 2px solid #e2e8f0;
    }
    
    /* –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ */
    .order-modal-content {
        max-width: 500px;
        width: 95%;
        max-height: 80vh;
        border-radius: var(--border-radius);
        background: white;
        border: 1px solid #e2e8f0;
    }
    
    .order-form-container {
        padding: 0 10px;
    }
    
    .order-summary {
        background: linear-gradient(135deg, var(--primary-color) 0%, #38a169 100%);
        color: white;
        padding: 20px;
        border-radius: var(--border-radius);
        margin-bottom: 20px;
    }
    
    .order-summary h3 {
        margin: 0 0 15px 0;
        color: white;
        font-size: 1.2rem;
    }
    
    .order-summary-item {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        font-size: 1rem;
    }
    
    .order-summary-item:last-child {
        border-bottom: none;
    }
    
    .order-summary-total {
        font-size: 1.2rem;
        font-weight: bold;
        margin-top: 10px;
        padding-top: 12px;
        border-top: 2px solid rgba(255, 255, 255, 0.3);
    }
    
    .order-form-container h3 {
        color: #2d3748;
        margin: 25px 0 15px 0;
        font-size: 1.2rem;
    }
    
    .order-form-group {
        margin-bottom: 20px;
    }
    
    .order-form-group label {
        display: block;
        margin-bottom: 8px;
        font-weight: 600;
        color: #4a5568;
        font-size: 1rem;
    }
    
    .order-form-group input,
    .order-form-group textarea {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1rem;
        transition: all 0.3s ease;
        background: white;
        color: #2d3748;
    }
    
    .order-form-group input:focus,
    .order-form-group textarea:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(45, 143, 109, 0.1);
    }
    
    /* –ó–∞–≥–æ–ª–æ–≤–∫–∏ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
    .modal-header {
        padding: 20px;
        border-bottom: 1px solid #e2e8f0;
        background: white;
        border-radius: var(--border-radius) var(--border-radius) 0 0;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .modal-header h2 {
        margin: 0;
        font-size: 1.4rem;
        display: flex;
        align-items: center;
        gap: 10px;
        color: #2d3748;
    }
    
    .modal-header h2 i {
        color: var(--primary-color);
    }
    
    .modal-close {
        background: none;
        border: none;
        font-size: 1.6rem;
        cursor: pointer;
        color: #718096;
        transition: color 0.2s ease;
        line-height: 1;
        padding: 5px;
    }
    
    .modal-close:hover {
        color: #2d3748;
    }
    
    .modal-footer {
        padding: 20px;
        border-top: 1px solid #e2e8f0;
        display: flex;
        gap: 12px;
        background: #f7fafc;
        border-radius: 0 0 var(--border-radius) var(--border-radius);
    }
    
    .modal-footer .btn-outline {
        flex: 1;
        border: 2px solid #e2e8f0;
        color: #4a5568;
        padding: 10px;
    }
    
    .modal-footer .btn-primary {
        flex: 2;
        background: var(--primary-color);
        border: none;
        padding: 10px;
    }
    
    .modal-footer .btn-primary:hover {
        background: var(--primary-hover);
    }
    
    /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
    @keyframes modalSlideIn {
        from {
            opacity: 0;
            transform: translateY(-20px) scale(0.98);
        }
        to {
            opacity: 1;
            transform: translateY(0) scale(1);
        }
    }
    
    .modal-content {
        animation: modalSlideIn 0.3s ease-out;
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ */
    @media (max-width: 992px) {
        .product-modal-content {
            grid-template-columns: 1fr;
            gap: 25px;
        }
        
        .product-modal-image {
            height: 350px;
        }
        
        .product-image {
            height: 240px;
        }
    }
    
    @media (max-width: 768px) {
        .product-modal .modal-content {
            width: 98%;
            max-height: 85vh;
            margin: 10px;
        }
        
        .product-modal-image {
            height: 300px;
            padding: 20px;
        }
        
        .product-image {
            height: 200px;
        }
        
        .modal-header {
            padding: 15px;
        }
        
        .modal-body {
            padding: 20px;
        }
        
        .modal-footer {
            padding: 15px;
            flex-direction: column;
        }
        
        .product-modal-actions {
            flex-direction: column;
        }
        
        .product-modal-price {
            font-size: 1.6rem;
        }
        
        .cart-modal-content,
        .order-modal-content {
            max-width: 95%;
            margin: 10px;
        }
        
        .product-card {
            min-height: 380px;
        }
    }
    
    @media (max-width: 480px) {
        .product-image {
            height: 180px;
        }
        
        .product-modal-image {
            height: 250px;
            padding: 15px;
        }
        
        .product-modal .modal-content {
            border-radius: 8px;
        }
        
        .product-modal-info h3 {
            font-size: 1.3rem;
        }
        
        .product-card {
            min-height: 350px;
        }
        
        .product-title {
            font-size: 1rem;
        }
        
        .product-price {
            font-size: 1.2rem;
        }
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –ø—É—Å—Ç—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π */
    .empty-cart-message {
        text-align: center;
        padding: 40px 20px;
    }
    
    .empty-cart-message i {
        font-size: 2.5rem;
        color: #cbd5e0;
        margin-bottom: 15px;
    }
    
    .empty-cart-message p {
        font-size: 1.1rem;
        color: #718096;
        margin-bottom: 8px;
    }
    
    .empty-cart-message small {
        color: #a0aec0;
    }
    
    /* –ë–∞–∑–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω */
    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }
    
    .modal.active {
        display: flex;
    }
    
    
    
    /* –û–±—Ä–µ–∑–∫–∞ –¥–ª–∏–Ω–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ */
    .text-truncate-2 {
        display: -webkit-box;
        -webkit-line-clamp: 2;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–∫–æ–Ω–æ–∫ –±–µ–∑ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
    .product-image .fas.fa-capsules {
        font-size: 70px;
        color: #2d8f6d;
        opacity: 0.7;
    }
</style>
{% endblock %}

{% block content %}
<!-- Pharmacy Section -->
<section class="pharmacy-section">
    <div class="container">
        <h1 class="page-title">–ê–ø—Ç–µ–∫–∞ MedAI</h1>
        <div class="pharmacy-controls">
            <div class="search-container">
                <input type="text" id="search-input" placeholder="–ü–æ–∏—Å–∫ –ª–µ–∫–∞—Ä—Å—Ç–≤...">
                <button id="search-btn"><i class="fas fa-search"></i></button>
            </div>
            <div class="filter-container">
                <select id="category-filter">
                    <option value="">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                    <option value="pain">–û–±–µ–∑–±–æ–ª–∏–≤–∞—é—â–∏–µ</option>
                    <option value="cold">–û—Ç –ø—Ä–æ—Å—Ç—É–¥—ã</option>
                    <option value="allergy">–û—Ç –∞–ª–ª–µ—Ä–≥–∏–∏</option>
                    <option value="vitamins">–í–∏—Ç–∞–º–∏–Ω—ã</option>
                    <option value="digestive">–î–ª—è –ø–∏—â–µ–≤–∞—Ä–µ–Ω–∏—è</option>
                    <option value="other">–î—Ä—É–≥–æ–µ</option>
                </select>
            </div>
        </div>
        <div class="products-grid" id="products-container">
            {% if products %}
                {% for product in products %}
                <div class="product-card" data-id="{{ product.id }}" data-category="{{ product.category }}">
                    <div class="product-image">
                        {% if product.image %}
                            <img src="{{ product.image.url }}" alt="{{ product.name }}" loading="lazy"
                                 data-full-image="{{ product.image.url }}">
                        {% else %}
                            <i class="fas fa-capsules"></i>
                        {% endif %}
                    </div>
                    <div class="product-info">
                        <h3 class="product-title text-truncate-2">{{ product.name }}</h3>
                        <p class="product-description text-truncate-2">
                            {{ product.description|truncatechars:120 }}
                        </p>
                        <div class="product-price">{{ product.price }} ‚Ç∏</div>
                        <div class="product-actions">
                            <button class="btn-outline view-details-btn" data-id="{{ product.id }}">–ü–æ–¥—Ä–æ–±–Ω–µ–µ</button>
                            <button class="btn-primary add-to-cart-btn" 
                                    data-id="{{ product.id }}" 
                                    data-name="{{ product.name }}" 
                                    data-price="{{ product.price }}">
                                –í –∫–æ—Ä–∑–∏–Ω—É
                            </button>
                        </div>
                    </div>
                </div>
                {% endfor %}
            {% else %}
                <div class="no-products">
                    <i class="fas fa-box-open"></i>
                    <p>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                    <small>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É</small>
                </div>
            {% endif %}
        </div>
    </div>
</section>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ç–æ–≤–∞—Ä–∞ -->
<div id="product-modal" class="modal product-modal">
    <div class="modal-content">
        <!-- –ö–æ–Ω—Ç–µ–Ω—Ç –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JavaScript -->
    </div>
</div>

<!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
<div class="modal" id="cart-modal">
    <div class="modal-content cart-modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-shopping-cart"></i> –ö–æ—Ä–∑–∏–Ω–∞</h2>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div class="cart-items" id="cart-items">
                <div class="empty-cart-message">
                    <i class="fas fa-shopping-cart"></i>
                    <p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
                    <small>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞</small>
                </div>
            </div>
            <div class="cart-summary">
                <div class="cart-total-row">
                    <span>–°—Ç–æ–∏–º–æ—Å—Ç—å —Ç–æ–≤–∞—Ä–æ–≤:</span>
                    <span id="cart-subtotal">0 ‚Ç∏</span>
                </div>
                <div class="cart-total-row total">
                    <span>–ò—Ç–æ–≥–æ:</span>
                    <span id="cart-total-price">0 ‚Ç∏</span>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-outline" id="continue-shopping">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏</button>
            <button class="btn-primary" id="checkout-btn">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
        </div>
    </div>
</div>

<!-- –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞ -->
<div class="modal" id="order-modal">
    <div class="modal-content order-modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-clipboard-check"></i> –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
            <button class="modal-close">&times;</button>
        </div>
        <div class="modal-body">
            <div class="order-form-container">
                <div class="order-summary" id="order-summary">
                    <!-- –°—é–¥–∞ –±—É–¥–µ—Ç –≤—Å—Ç–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∑–∞–∫–∞–∑–µ -->
                </div>
                
                <h3>–í–∞—à–∏ –¥–∞–Ω–Ω—ã–µ</h3>
                <form id="order-form">
                    <div class="order-form-group">
                        <label for="customer-name">–§–ò–û *</label>
                        <input type="text" id="customer-name" name="name" required placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á">
                    </div>
                    
                    <div class="order-form-group">
                        <label for="customer-phone">–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                        <input type="tel" id="customer-phone" name="phone" required placeholder="+7 (777) 123-45-67">
                    </div>
                    
                    <div class="order-form-group">
                        <label for="delivery-address">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏ *</label>
                        <input type="text" id="delivery-address" name="address" required placeholder="–ì–æ—Ä–æ–¥, —É–ª–∏—Ü–∞, –¥–æ–º, –∫–≤–∞—Ä—Ç–∏—Ä–∞">
                    </div>
                    
                    <div class="order-form-group">
                        <label for="order-comment">–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –∫ –∑–∞–∫–∞–∑—É (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                        <textarea id="order-comment" name="comment" rows="2" placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è"></textarea>
                    </div>
                    
                    <button type="submit" class="btn-primary" style="width: 100%; padding: 12px; margin-top: 10px;">
                        <i class="fas fa-paper-plane"></i> –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- AI Chat Widget -->
<div class="chat-widget">
    <div class="chat-header">
        <span>–ò–ò-–ø–æ–º–æ—â–Ω–∏–∫ MedAI</span>
        <button class="chat-close"><i class="fas fa-times"></i></button>
    </div>
    <div class="chat-messages">
        <div class="message ai-message">
            <div class="message-avatar">
                <i class="fas fa-robot"></i>
            </div>
            <div class="message-content">
                <p>–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –Ø –ò–ò-–ø–æ–º–æ—â–Ω–∏–∫ MedAI. –ß–µ–º –º–æ–≥—É –≤–∞–º –ø–æ–º–æ—á—å?</p>
            </div>
        </div>
    </div>
    <div class="chat-input">
        <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –≤–æ–ø—Ä–æ—Å...">
        <button class="send-btn"><i class="fas fa-paper-plane"></i></button>
    </div>
</div>
<div class="chat-toggle">
    <i class="fas fa-comment-medical"></i>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä–∑–∏–Ω—ã
    let cart = JSON.parse(localStorage.getItem('medai_cart')) || [];
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
    function updateCartCount() {
        const count = cart.reduce((total, item) => total + item.quantity, 0);
        const cartCountElement = document.getElementById('cart-count');
        if (cartCountElement) {
            cartCountElement.textContent = count;
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É
    function addToCart(productId, productName, price, quantity = 1) {
        const existingItem = cart.find(item => item.id === productId);
        
        if (existingItem) {
            existingItem.quantity += quantity;
        } else {
            cart.push({
                id: productId,
                name: productName,
                price: price,
                quantity: quantity
            });
        }
        
        localStorage.setItem('medai_cart', JSON.stringify(cart));
        updateCartCount();
        showNotification(`${productName} –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!`);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
    function showNotification(message) {
        const notification = document.createElement('div');
        notification.className = 'notification';
        notification.innerHTML = `
            <div class="notification-content">
                <i class="fas fa-check-circle"></i>
                <span>${message}</span>
            </div>
        `;
        
        notification.style.cssText = `
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #2d8f6d 0%, #38a169 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 6px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            z-index: 9999;
            animation: slideInRight 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
        `;
        
        document.body.appendChild(notification);
        
        setTimeout(() => {
            notification.style.animation = 'slideOutRight 0.3s ease-out forwards';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —Ç–æ–≤–∞—Ä–∞
    function openProductModal(productId) {
        const productCard = document.querySelector(`.product-card[data-id="${productId}"]`);
        if (!productCard) return;
        
        const productName = productCard.querySelector('.product-title').textContent;
        const productDescription = productCard.querySelector('.product-description').textContent;
        const productPrice = productCard.querySelector('.product-price').textContent;
        const productImage = productCard.querySelector('.product-image img');
        const productImageSrc = productImage ? productImage.dataset.fullImage || productImage.src : '';
        
        const modal = document.getElementById('product-modal');
        const modalContent = modal.querySelector('.modal-content');
        
        // –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        modalContent.innerHTML = `
            <div class="modal-header">
                <h2><i class="fas fa-capsules"></i> ${productName}</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="product-modal-content">
                    <div class="product-modal-image">
                        ${productImageSrc ? 
                            `<img src="${productImageSrc}" alt="${productName}" loading="lazy">` : 
                            `<i class="fas fa-capsules" style="font-size: 100px; color: #2d8f6d; opacity: 0.7;"></i>`
                        }
                    </div>
                    <div class="product-modal-info">
                        <div>
                            <h3>${productName}</h3>
                            <div class="product-modal-price">${productPrice}</div>
                        </div>
                        
                        <div class="product-modal-description">
                            ${productDescription}
                        </div>
                        
                        <div class="product-modal-actions">
                            <button class="btn-outline" id="close-product-modal">
                                <i class="fas fa-times"></i> –ó–∞–∫—Ä—ã—Ç—å
                            </button>
                            <button class="btn-primary add-to-cart-modal-btn" 
                                    data-id="${productId}" 
                                    data-name="${productName}" 
                                    data-price="${productPrice.replace(' ‚Ç∏', '')}">
                                <i class="fas fa-shopping-cart"></i> –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ—Ä–∑–∏–Ω—É
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        modal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        function closeModal() {
            modal.style.display = 'none';
            document.body.style.overflow = 'auto';
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è
        modalContent.querySelector('.modal-close').addEventListener('click', closeModal);
        modalContent.querySelector('#close-product-modal').addEventListener('click', closeModal);
        
        modal.addEventListener('click', function(e) {
            if (e.target === modal) closeModal();
        });
        
        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –∫–æ—Ä–∑–∏–Ω—É –∏–∑ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
        const addToCartBtn = modalContent.querySelector('.add-to-cart-modal-btn');
        if (addToCartBtn) {
            addToCartBtn.addEventListener('click', function() {
                const productId = this.dataset.id;
                const productName = this.dataset.name;
                const price = parseFloat(this.dataset.price);
                addToCart(productId, productName, price);
                closeModal();
            });
        }
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    document.addEventListener('DOMContentLoaded', function() {
        updateCartCount();
        
        // –û—Ç–∫—Ä—ã—Ç–∏–µ –∫–æ—Ä–∑–∏–Ω—ã
        const cartIcon = document.getElementById('cart-icon');
        if (cartIcon) {
            cartIcon.addEventListener('click', function() {
                openCartModal();
            });
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∫–æ—Ä–∑–∏–Ω—ã
        document.querySelectorAll('.add-to-cart-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const productId = this.dataset.id;
                const productName = this.dataset.name;
                const price = parseFloat(this.dataset.price);
                addToCart(productId, productName, price);
            });
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ "–ü–æ–¥—Ä–æ–±–Ω–µ–µ"
        document.querySelectorAll('.view-details-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const productId = this.dataset.id;
                openProductModal(productId);
            });
        });
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        setupSearchAndFilter();
        
        // –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞
        document.getElementById('checkout-btn')?.addEventListener('click', function() {
            openOrderModal();
        });
        
        // –û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–æ—Ä–º—ã –∑–∞–∫–∞–∑–∞
        document.getElementById('order-form')?.addEventListener('submit', function(e) {
            e.preventDefault();
            submitOrder();
        });
        
        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω
        document.querySelectorAll('.modal-close').forEach(btn => {
            btn.addEventListener('click', function() {
                const modal = this.closest('.modal');
                modal.style.display = 'none';
                document.body.style.overflow = 'auto';
            });
        });
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === this) {
                    this.style.display = 'none';
                    document.body.style.overflow = 'auto';
                }
            });
        });
    });
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
    function setupSearchAndFilter() {
        const searchBtn = document.getElementById('search-btn');
        const searchInput = document.getElementById('search-input');
        const categoryFilter = document.getElementById('category-filter');
        
        if (searchBtn) {
            searchBtn.addEventListener('click', filterProducts);
        }
        
        if (searchInput) {
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    filterProducts();
                }
            });
        }
        
        if (categoryFilter) {
            categoryFilter.addEventListener('change', filterProducts);
        }
    }
    
    function filterProducts() {
        const searchTerm = document.getElementById('search-input').value.toLowerCase();
        const selectedCategory = document.getElementById('category-filter').value;
        const productCards = document.querySelectorAll('.product-card');
        
        productCards.forEach(card => {
            const productName = card.querySelector('.product-title').textContent.toLowerCase();
            const productDesc = card.querySelector('.product-description').textContent.toLowerCase();
            const productCategory = card.dataset.category;
            
            let showCard = true;
            
            if (searchTerm && !productName.includes(searchTerm) && !productDesc.includes(searchTerm)) {
                showCard = false;
            }
            
            if (selectedCategory && productCategory !== selectedCategory) {
                showCard = false;
            }
            
            card.style.display = showCard ? 'block' : 'none';
        });
        
        const visibleCards = Array.from(productCards).filter(card => card.style.display !== 'none');
        const productsContainer = document.getElementById('products-container');
        
        if (visibleCards.length === 0) {
            if (!document.querySelector('.no-products')) {
                const noProductsDiv = document.createElement('div');
                noProductsDiv.className = 'no-products';
                noProductsDiv.innerHTML = `
                    <i class="fas fa-search"></i>
                    <p>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
                    <small>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –∫—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞</small>
                `;
                productsContainer.appendChild(noProductsDiv);
            }
        } else {
            const noProductsDiv = document.querySelector('.no-products');
            if (noProductsDiv) {
                noProductsDiv.remove();
            }
        }
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–æ—Ä–∑–∏–Ω—ã
    function openCartModal() {
        const cartModal = document.getElementById('cart-modal');
        const cartItems = document.getElementById('cart-items');
        
        if (cart.length === 0) {
            cartItems.innerHTML = `
                <div class="empty-cart-message">
                    <i class="fas fa-shopping-cart"></i>
                    <p>–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p>
                    <small>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞</small>
                </div>
            `;
        } else {
            let itemsHtml = '';
            let subtotal = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                itemsHtml += `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <h4 class="text-truncate-2">${item.name}</h4>
                            <p>${item.price} ‚Ç∏ √ó ${item.quantity}</p>
                        </div>
                        <div class="cart-item-actions">
                            <button class="cart-item-remove" data-id="${item.id}">
                                <i class="fas fa-trash"></i>
                            </button>
                            <span class="cart-item-total">${itemTotal} ‚Ç∏</span>
                        </div>
                    </div>
                `;
            });
            
            cartItems.innerHTML = itemsHtml;
            document.getElementById('cart-subtotal').textContent = subtotal + ' ‚Ç∏';
            document.getElementById('cart-total-price').textContent = subtotal + ' ‚Ç∏';
            
            document.querySelectorAll('.cart-item-remove').forEach(btn => {
                btn.addEventListener('click', function() {
                    const itemId = this.dataset.id;
                    removeFromCart(itemId);
                    openCartModal();
                });
            });
        }
        
        cartModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        document.getElementById('continue-shopping').addEventListener('click', function() {
            cartModal.style.display = 'none';
            document.body.style.overflow = 'auto';
        });
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã
    function removeFromCart(productId) {
        cart = cart.filter(item => item.id != productId);
        localStorage.setItem('medai_cart', JSON.stringify(cart));
        updateCartCount();
        showNotification('–¢–æ–≤–∞—Ä —É–¥–∞–ª–µ–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã');
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è —Ñ–æ—Ä–º—ã –∑–∞–∫–∞–∑–∞
    function openOrderModal() {
        if (cart.length === 0) {
            alert('–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞. –î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –ø–µ—Ä–µ–¥ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º –∑–∞–∫–∞–∑–∞.');
            return;
        }
        
        const orderModal = document.getElementById('order-modal');
        const orderSummary = document.getElementById('order-summary');
        
        let summaryHtml = '<h3>–í–∞—à –∑–∞–∫–∞–∑:</h3>';
        let subtotal = 0;
        
        cart.forEach(item => {
            const itemTotal = item.price * item.quantity;
            subtotal += itemTotal;
            
            summaryHtml += `
                <div class="order-summary-item">
                    <span class="text-truncate-2">${item.name} √ó ${item.quantity}</span>
                    <span>${itemTotal} ‚Ç∏</span>
                </div>
            `;
        });
        
        summaryHtml += `
            <div class="order-summary-item order-summary-total">
                <span>–ò—Ç–æ–≥–æ:</span>
                <span>${subtotal} ‚Ç∏</span>
            </div>
        `;
        
        orderSummary.innerHTML = summaryHtml;
        
        const savedData = JSON.parse(localStorage.getItem('medai_customer_data')) || {};
        
        document.getElementById('customer-name').value = savedData.name || '';
        document.getElementById('customer-phone').value = savedData.phone || '';
        document.getElementById('delivery-address').value = savedData.address || '';
        
        orderModal.style.display = 'flex';
        document.body.style.overflow = 'hidden';
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
        document.getElementById('cart-modal').style.display = 'none';
    }
    
    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–∫–∞–∑–∞
    function submitOrder() {
        const form = document.getElementById('order-form');
        const formData = new FormData(form);
        
        const customerData = {
            name: formData.get('name'),
            phone: formData.get('phone'),
            address: formData.get('address'),
            comment: formData.get('comment')
        };
        
        localStorage.setItem('medai_customer_data', JSON.stringify(customerData));
        
        const orderData = {
            customer: customerData,
            cart: cart,
            total: cart.reduce((sum, item) => sum + (item.price * item.quantity), 0),
            order_date: new Date().toISOString(),
            order_id: 'MED' + Date.now()
        };
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–∫–∞–∑ –≤ localStorage
        const orders = JSON.parse(localStorage.getItem('medai_orders')) || [];
        orders.push(orderData);
        localStorage.setItem('medai_orders', JSON.stringify(orders));
        
        // –û—á–∏—â–∞–µ–º –∫–æ—Ä–∑–∏–Ω—É
        cart = [];
        localStorage.removeItem('medai_cart');
        updateCartCount();
        
        // –ó–∞–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
        document.getElementById('cart-modal').style.display = 'none';
        document.getElementById('order-modal').style.display = 'none';
        document.body.style.overflow = 'auto';
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
        alert(`‚úÖ –ó–∞–∫–∞–∑ ‚Ññ${orderData.order_id} —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω!\n\nüìû –ú—ã —Å–≤—è–∂–µ–º—Å—è —Å –≤–∞–º–∏ –ø–æ —Ç–µ–ª–µ—Ñ–æ–Ω—É: ${customerData.phone}\n\nüí∞ –°—É–º–º–∞ –∑–∞–∫–∞–∑–∞: ${orderData.total} ‚Ç∏\n\n–°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É –≤ MedAI!`);
        
        showNotification('‚úÖ –ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω!');
    }
</script>
{% endblock %}